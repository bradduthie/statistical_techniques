# (PART) Hypothesis testing {-}

# Week 6 Overview {-#Week6}

|                 |                                   |
|-----------------|-----------------------------------|
| **Dates**       | 27 February 2023 - 03 MAR 2023 |
| **Reading**     | **Required:**  SCIU4T4 Workbook chapters   |
|                 | **Recommended:** @Navarro2022 [Chapter 11](https://davidfoxcroft.github.io/lsj-book/11-Comparing-two-means.html)    |
|                 | **Suggested:**     |
|                 | **Advanced:** None |
| **Lectures**    | 5.1: CIs |
|                 | 5.2: The t-interval |
| **Practical**   | z- and t- intervals ([Chapter 19](#Chapter_19))       |
|                 |   Room: Cottrell 2A17         |
|                 |   Group A: 22 FEB 2023 (WED) 13:05-15:55 |
|                 |   Group B: 23 FEB 2023 (THU) 09:05-11:55 |
| **Help hours**  | Ian Jones                       |
|                 |   Room: Cottrell 1A13           |
|                 |   24 FEB 2023 (FRI) 15:05-17:55 |
| **Assessments** | [Week 4 Practice quiz](https://canvas.stir.ac.uk/courses/13075/quizzes/29675) on Canvas  |


Week 5 focuses making statistical inferences using confidence intervals (CIs) and and introduces the t-interval.

[Chapter 20](#Chapter_20) 

[Chapter 21](#Chapter_21) 

[Chapter 22](#Chapter_22) 

# What is hypothesis testing? {#Chapter_20}

Statistical hypotheses are different from scientific hypotheses.
In science, a hypothesis should make some kind of testable statement about the relationship between two or more different concepts or observations [@Bouma2000].
For example, we might hypothesise that in a particular population of sparrows, juveniles that have higher body mass will also have higher survival rates.
In contrast, statistical hypotheses compare a sample outcome to the outcome predicted given a relevant statistical distribution [@Sokal1995].
That is, we start with a hypothesis that our data are sampled from some distribution, then work out whether or not we should reject this hypothesis.
This concept is counter-intuitive, but it is **absolutely fundamental for understanding the logic underlying most modern statistical techniques** [@Sokal1995; @Mayo1996; @Greenland2016], including all subsequent chapters of this workbook, so we will focus on it here in-depth.
The most instructive way to explain the general idea is with the example of coin flips [@Mayo1996], as we looked at in [Chapter 14](#Chapter_14).

## How ridiculous is our hypothesis?

Imagine that a coin is flipped 100 times.
We are told that the coin is fair, meaning that there is an equal probability of it landing on heads or tails (i.e., the probability is 0.5 for both heads and tails in any given flip).
From [Chapter 14.4.1](#Chapter_14.html#binomial-distribution), recall that the number of times out of 100 that the coin flip comes up heads will be described by a binomial distribution.
The most probable outcome will be 50 heads and 50 tails, but frequencies that deviate from this perfect 50:50 ratio (e.g., 48 heads and 52 tails) are also expected to be fairly common (Figure 20.1).


```{r, echo = FALSE, fig.alt = "A barplot is shown with 101 bars, which correspond to the number of times a coin flip lands on heads; the distribution takes a humped shape", fig.cap = "Probability distribution for the number of times that a flipped coin lands on heads in 100 trials. Note that some areas of parameter space on the x-axis are cut off because the pobabilities associated with this number of flips out of 100 being heads are so low."}
par(mar = c(5, 5, 1.5, 1.5));
pr_binom <- dbinom(x = 0:100, size = 100, prob = 0.5);
plot(x = 0, y = 0, xlim = c(31, 69), type = "n", ylim = c(0, 0.09), 
     xaxt = "n", ylab = "Probability", xlab = "Times a coin flip is heads", 
     cex.lab = 1.25, cex.axis = 1.25, yaxs = "i");
axis(side = 1, at = 1:101, labels = 0:100);
for(i in 1:101){
  yy <- seq(from = 0, to = pr_binom[i], length = 100);
  points(x = rep(i, times = 100), y = yy, type = "l", lwd = 6);  
}
```

The distribution in Figure 20.1 is what we expect to happen if the coin we are flipping 100 times is actually fair.
In other words, it is the predicted distribution of outcomes *if our hypothesis that the coin is fair is true* (more on that later).
Now, suppose that we actually run the experiment; we flip the coin in question 100 times.
Perhaps we observe heads 30 times out of the 100 total flips.
From the distribution in Figure 20.1, this result seems *very* unlikely if the coin is actually fair.
If we do the maths, the probability of observing 30 heads or fewer (i.e., getting anywhere between 0 and 30 heads total) is only $P = 0.0000392507$.
And the probability of getting this much of a deviation from 50 heads (i.e., either 20 less than or 20 more than 50) is $P = 0.0000785014$ (two times 0.0000392507, since the binomial distribution is symmetrical around 50).
This seems a bit ridiculous!
Do we *really* believe that the coin is fair if the probability of getting a result this extreme is so low?

Getting 30 head flips is maybe a bit extreme.
What if we flip the coin 100 times and get 45 heads?
In this case, if the coin is fair, then we would predict this number heads or fewer with a probability of about $P = 0.0967$ (i.e., about 9.67\% of the time, we would expect to get 45 or fewer heads).
And we would predict a deviation as extreme as 5 from the 50:50 ratio of heads to tails with a probability of about $P = 0.193$ (i.e., about 19.3\% of the time, we would get 45 heads or fewer, or 55 heads or more).
This does not sound nearly so unrealistic.
If a fair coin will give us this much of a deviation from the expected 50 heads and 50 tails about 20\% of the time, then perhaps our hypothesis is not so ridiculous, and we can conclude the coin is indeed fair.

How improbable does our result need to be to cause us to reject our hypothesis that the coin is fair?
There is no definitive answer to this question.
In the biological and environmental sciences, we traditionally use a probability of 0.05, but this threshold is completely arbitrary[^29].
All it means is that we are willing to reject our hypothesis (e.g., declare the coin to be unfair) when it is actually true (i.e., the coin really *is* fair) about 5\% of the time.
Note that we do need to decide on some finite threshold for rejecting our hypothesis because even extremely rare events, by definition, can sometimes happen.
In the case of 100 coin flips, there is always a small probability of getting *any* number of heads from a fair coin (although getting zero heads would be extraordinarily rare, $P \approx 7.89 \times 10^{-31}$, i.e., a decimal followed by 30 zeros, then a 7).
We can therefore never be *certain* about rejecting or not rejecting the hypothesis that we have a fair coin.

This was a very concrete example intended to provide an intuitive way of thinking about hypothesis testing in statistics.
In the next section, we will look more generally at what hypothesis testing means in statistics and the terminology associated with it.
But everything that follows basically relies on the same general logic as the coin-flipping example here; **if our hypothesis is true, then what is the probability of our result?**

[^29]: I have heard many apocryphal stories about how a probability of 0.05 was decided upon, but I have no idea which, if any, of these stories are actually true. 

## Statistical hypothesis testing

A statistical test is used to decide if we should reject the hypothesis that some observed value or calculated statistic was sampled from a particular distribution [@Sokal1995].
In the case of the coin example in the previous section, the observed value was the number of heads, and the distribution was the binomial distribution.
In other cases, we might, e.g., test the hypothesis that a value was sampled from a normal or t-distribution.
In all of these cases, the hypothesis that we are testing is the **null hypothesis**, which we abbreviate as $H_{0}$ (e.g., the coin is fair).
Typically, $H_{0}$ is associated with the lack of an interesting statistical pattern, such as when a coin is fair, when there is no difference between two groups of observations, or when two variables are not associated with each other.
This null hypothesis contrasts an **alternative hypothesis**, which we abbreviate as $H_{A}$ (e.g., the coin is not fair).
Alternative hypotheses are always defined by some relationship to $H_{0}$ [@Sokal1995].
Typically, $H_{A}$ is associated with something interesting happening, such as a biased coin, a difference between groups of observations, or an association between two variables.
Table 20.1 below presents some null and alternative hypotheses that might relevant in the biological or environmental sciences.

| Null hypothesis $H_{0}$            | Alternative hypothesis $H_{A}$          |
|------------------------------------|-----------------------------------------|
| There is no difference between juvenile and adult sparrow mortality | Mortality differs between juvenile and adult sparrows |
| Amphibian body size does not change with increasing latitude | Amphibian body size increases with latitude |
| Soil nitrogen concentration does not differ between agricultural and non-agricultural fields | Soil nitrogen concentration is lower in non-agricultural fields |

Table: Hypothetical null and alternative hypotheses in the biological and environmental sciences.

Notice that alternative hypotheses can indicate direction (e.g., amphibian body size will increase, or nitrogen content will be lower in non-agricultural fields), or they can be non-directional (e.g., mortality will be different based on life-history stage).
When our alternative hypothesis indicates direction, we say that the hypothesis is **one-sided**.
This is because we are looking at one side of the null distribution.
In the case of our coin example, a one-sided $H_{A}$ might be that the probability of flipping heads is less than 0.5, meaning that we reject $H_{0}$ only given numbers on the left side of the distribution in Figure 20.1 (where the number of flips heads are fewer than 50).
A different one-sided $H_{A}$ would be that the probability of flipping heads is greater than 0.5, in which case we would reject $H_{0}$ only given numbers on the right side of the distribution.
In contrast, when our alternative hypothesis does not indicate direction, we say that the hypothesis is **two-sided**.
This is because we are looking at both sides of the null distribution.
In the case of our coin example, we might not care in which direction the coin is biased (towards heads or tails), just that the probability of flipping heads does not equal 0.5.
In this case, we reject $H_{0}$ at both extremes of the distribution of Figure 20.1.

## P-values, false positives, and power

In our hypothetical coin flipping example, we used $P$ to indicate the probability of getting a particular number of heads out of 100 total flips if our coin was fair.
This $P$ (sometimes denoted with a lower-case $p$) is what we call a 'p-value'.

> **A p-value is the probability of getting a result as or more extreme than the one observed assuming $H_{0}$ is true.[^30]**

This is separated and in bold because it is a very important concept in statistics, and it is one that is very, very easy to misinterpret[^31].
A p-value is *not* the probability that the null hypothesis is true (we actually have no way of knowing this probability).
It is also not the probability that an alternative hypothesis is false (we have no way of knowing this probability either).
A p-value specifically *assumes that the null hypothesis is true*, then asks what the probability of an observed result would be *conditional upon this assumption*.
In the case of our coin flipping example, we cannot really know the probability that the coin is fair or unfair (depending on your philosophy of statistics, this might not even make conceptual sense).
But we can say that **if** the coin **is** fair, then an observation of $\leq 45$ would occur with a probability of $P = 0.0967$.

Before actually calculating a p-value, we typically set a threshold level ($\alpha$) below which we will conclude that our p-value is **statistically significant**[^32].
As mentioned in [section 20.1](#how-ridiculous-is-our-hypothesis), we traditionally set $\alpha= 0.05$ in the biological and environmental sciences (although rarely $\alpha = 0.01$ is used).
This means that if $P \leq 0.05$, then we reject $H_{0}$ and conclude that our observation is statistically significant.
It also means that even when $H_{0}$ really is true (e.g., the coin is really fair), we will mistakenly reject $H_{0}$ with a probability of 0.05 (i.e., 5\% of the time).
This is called a **Type I error** (i.e., a false positive), and it typically means that we will infer a pattern of some kind (e.g., a difference between groups, or a relationship between variables) where none really exists.
This is obviously an error that we want to avoid, which is why we set $\alpha$ to a low value.

In contrast, we can also fail to reject $H_{0}$ when $H_{A}$ is actually true.
That is, we might mistakenly conclude that there is no evidence to reject the null hypothesis when the null hypothesis really is false.
This is called a **Type II error**.
The probability that we commit a Type II error, i.e., that we fail to reject the null hypothesis when it is false, is given the symbol $\beta$.
Since $\beta$ is the probability that we fail to reject $H_{0}$ when it is false, $1 - \beta$ is the probability that that we *do* reject $H_{0}$ when it is false.
This $1 - \beta$ is the **statistical power** of a statistical test.
Note that $\alpha$ and $\beta$ are not necessarily related to each other.
Our $\alpha$ is whatever we set it to be (e.g., $\alpha = 0.05$).
But statistical power will depend on the size of the effect that we are measuring (e.g., how much bias their is in a coin if we are testing whether or not it is fair), and on the size of our sample.
Increasing our sample size will always increase our statistical power, i.e., our ability to reject the null hypothesis when it is really false.
Table 20.1 below illustrates the relationship between whether or not $H_{0}$, and whether or not we reject it.

|                  | Do not reject $H_{0}$   |  Reject $H_{0}$       |
|------------------|-------------------------|-----------------------|
| $H_{0}$ is true  | Correct decision        | Type I  error         |
| $H_{0}$ is false | Type II error           | Correct decision      |

Table: Summary of Type I and Type II errors in relation to a null hypothesis ($H_{0}$).

Note that we never *accept* a null hypothesis; we just fail to reject it.
Statistical tests are not really set up in a way that $H_{0}$ can be accepted[^33].
The reason for this is subtle, but we can see the logic if we again consider the case of the fair coin.
If $H_{0}$ is true, then the probability of flipping heads is $P(heads) = 0.5$ (i.e., $H_{0}: P(heads) = 0.5$).
But even if we fail to reject $H_{0}$, this does not mean that we can conclude with any real confidence that our null hypothesis $P(heads) = 0.5$ is true.
What if we instead tested the null hypothesis that our coin was *very slightly* biased, such that $H_{0}:\:P(heads) = 0.4999$?
If we failed to reject the null hypothesis that $P(heads) = 0.5$, then we would probably also fail to reject a $H_{0}$ that $P(heads) = 0.4999$.
There is no way to meaningfully distinguish between these two potential null hypotheses by just testing one of them.
We therefore cannot conclude that a $H_{0}$ is correct; we can only find evidence to reject it.
In contrast, we can reasonably accept an alternative hypothesis $H_{A}$ when we reject $H_{0}$.


[^30]: Technically, it also assumes that all of the assumptions of the model underlying the hypothesis test are true, but we will worry about this later.

[^31]: In fact, the p-value is so easy to mis-interpret and so widely mis-used, that some scientists have called for them to be abandoned entirely [@Wasserstein2016; but see @Stanton-Geddes2014; @Mayo2019].

[^32]: Like p-values, setting thresholds below which we consider $P$ to be significant is at least somewhat controversial [@McShane2019; @Mayo2021]. But the use of statistical significance thresholds is ubiquitous in the biological and environmental sciences, so we will use them throughout this lab workbook (it is important to understand them and interpret them).

[^33]: Note that we might, for non-statistical reasons conclude the absence of a particular phenomenon or relationship between observations. For example, following a statistical test, we might become convinced that a coin really is fair, or that there is no relationship between sparrow body mass and survival. But these are conclusions about scientific hypotheses, not statistical hypotheses.

# The t-test  {#Chapter_21}

A t-test is a simple and widely used statistical hypothesis test that relies on the t-distribution introduced in [Chapter 18](#Chapter_18).
In this chapter, we will look at 3 types of t-tests, (1) the one sample t-test, (2) the independent samples t-test, and (3) the paired samples t-test.
We will also look at non-parametric alternatives to t-tests (Wilcoxon and Mann-Whitney tests), which become relevant when the assumptions of t-tests are violated.
The use of all of these tests in Jamovi will be demonstrated in the lab practical in [Chapter 22](#Chapter_22).

## One sample t-test

Suppose that a biology teacher has created a new approach to teaching and wants to test whether or not their new approach results in student test scores that are higher than the reported national average of 60.
This teacher should first define their null and alternative hypotheses.

- $H_{0}$: Student test scores equal 60
- $H_{A}$: Student test scores are greater than 60

Note that this is a one-sided hypothesis.
The teacher is not interested in whether or not the mean test score of their students is below 60.
They just want to find out if the mean test scores are greater than 60.
Suppose the teacher has 10 students with the following test scores (out of 100).

```
49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1
```

The teacher can use a one sample t-test to test $H_{0}$.
The one sample t-test will test whether the sample mean of test scores ($\bar{y} = 66.58$) is significantly greater than the reported national average, $\mu_{0} = 60$.
How does this work?
Recall from [Chapter 15](#Chapter_15) that, due to the central limit theorem, the distribution of sample means ($\bar{y}$) will be normally distributed around the true mean $\mu$ as sample size N increases.
At low N, when we need to estimate the true standard deviation ($\sigma$) from the sample standard deviation (s), we need to correct for a bias and use the t-distribution (see [Chapter 18](#Chapter_18)).
The logic here is to use the t-distribution as the null distribution for $\bar{y}$.
If we subtract $\mu_{0}$ from $\bar{y}$, then we can centre the mean of the null distribution at 0.
We can then divide by the standard error of test scores so that we can compare the deviation of $\bar{y}$ from $\mu_{0}$ in terms of the t-distribution.
This is the same idea as calculating a z-score from [Chapter 15.2](#probability-and-z-scores).
In fact, the equations look almost the same,

$$t_{\bar{y}} = \frac{\bar{y} - \mu_{0}}{SE(\bar{y})}$$

In the above equation, $SE(\bar{y})$ is the standard error of $\bar{y}$.

If the sample mean of test scores is really the same as the population mean $\mu_{0} = 60$, then $\bar{y}$ should have a t-distribution.
Consequently, very small or large values of $t_{\bar{y}}$ would suggest that the sample mean is improbable given the null distribution predicted if $H_{0}: \mu_{0} = \bar{y}$ is true.
We can calculate $t_{\bar{y}}$ for our above sample (note, $SE(\bar{y}) = s/\sqrt{N} = 8.334373 / \sqrt{10} = 2.63556$),

$$t_{\bar{y}} = \frac{66.58 - 60}{2.63556} = 2.496623.$$

Our t-statistic is therefore 2.496623 (note that a t-statistic can also be negative; this would just mean that our sample mean is less than $\mu_{0}$, instead of greater than $\mu_{0}$, but nothing about the t-test changes if this is the case). 
We can see where this value falls on the t-distribution with 9 degrees of freedom in Figure 21.1.

```{r, echo = FALSE, fig.alt = "A bell curve of the t-distribution is shown with an arrow pointing downward on the x-axis value about halfway between 2 and 3.", fig.cap = "A t-distribution is shown with a calculated t-statistic of 2.49556 indicated with a downard arrow."}
par(mar = c(5, 5, 1.5, 1.5));
xx       <- seq(from = -5, to = 5, by = 0.001);
xx_vals  <- 1:10001;
yy       <- dt(xx, df = 9);
plot(x = xx, y = pr_norm, type = "l", ylim = c(0, 0.48), 
     ylab = "Probability",  xlab = "t-score", lwd = 2, xlim = c(-3, 3),
     cex.lab = 1.25, cex.axis = 1.25, yaxs = "i");
polygon(c(xx[xx_vals], xx[1], xx[10001]), 
        c(pr_norm[xx_vals], 0, 0), col="grey80");
arrows(x0 = 2.496623, x1 = 2.496623, y0 = 0.1, y1 = 0.002, lwd = 3);
mbox <- function(x0, x1, y0, y1){
    xx <- seq(from=x0, to=x1, length.out = 100);
    yy <- seq(from=y0, to=y1, length.out = 100);
    xd <- c(rep(x0, 100), xx, rep(x1,100), rev(xx));
    yd <- c(yy, rep(y1,100), rev(yy), rep(y0, 100));
    return(list(x=xd, y=yd));
}
tbox <- mbox(x0 = 2.496623 - 0.15, 
             x1 = 2.496623 + 0.15, y0 = 5, y1 = 9);
polygon(x=tbox$x, y=tbox$y, lwd=3, border="black", col="white");
text(x = 2.496623, y = 0.125, cex = 2, 
     labels = expression(paste(italic(t[bar(y)]))));
```

The t-distribution in Figure 21.1 is the probability distribution if $H_{0}$ is true (i.e., the student test scores were sampled from a distribution with a mean of $\mu_{0} = 60$).
The arrow pointing to the calculated $t_{\bar{y}} = 2.496623$ indicates that if $H_{0}$ is true, then the sample mean of student test scores $\bar{y} = 66.58$ would be very unlikely.
This is because only a small proportion of the probability distribution in Figure 21.1 is greater than or equal to our t-statistic, $t_{\bar{y}} = 2.496623$.
In fact, the proportion of t-statistics greater than 2.496623 is only about P = `r round(pt(q = 2.496623, df = 9, lower.tail = FALSE), digits = 3)`.
Hence, if our null hypothesis is true, then the probability of getting a mean student test score of 66.58 or higher is P = `r round(pt(q = 2.496623, df = 9, lower.tail = FALSE), digits = 3)` (this is our p-value).

It is important to understand the relationship between the t-statistic and the p-value.
An [interactive application](https://bradduthie.shinyapps.io/t_score/) helps visualise the relationship between the t-statistic and p-values.

> [Click here](https://bradduthie.shinyapps.io/t_score/) for the shiny app of the t-distribution

Typically, we set a threshold level of $\alpha = 0.05$, below which we conclude that our p-value is statistically significant (see [Chapter 20](#Chapter_20)).
Consequently, because our p-value is less than 0.05, we reject our null hypothesis and conclude that student test scores are higher than the reported national average.


## Independent samples t-test

Perhaps the biology teacher is not actually interested in comparing their students' test results with those of the reported national average.
After all, there might be many reasons for why their students score differently from the national average that have nothing to do with their new approach to teaching.
To see if their new approach is working, the teacher might instead decide that a better hypothesis to test is whether or not the mean test score from the current year is higher than the mean test score from the class that they taught in the previous year.
We can use $\bar{y}_{1}$ to denote the mean of test scores from the current year, and $\bar{y}_{0}$ to denote the mean of test scores from the previous year.
The test scores of the current year ($y_{1}$) therefore remain the same as in the example of the one sample t-test from the previous section.

```
49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1
```

Suppose that in the previous year, there were 9 students in the class (i.e., one fewer than the current year).
These 9 students received the following test scores ($y_{2}$).

```
57.4, 52.4, 70.5, 71.6, 46.1, 60.4, 70.0, 64.5, 58.8
```

The mean score from last year was $\bar{y}_{2} = 61.30$, which does appear to be lower than the mean score of the current year, $\bar{y}_{1} = 66.58$.
But is the difference between these two means statistically significant?
In other words, were the test scores from each year sampled from a population with the same mean, such that the population mean of the previous year ($\mu_{2}$) and the current year ($\mu_{1}$) are the same?
This is the null hypothesis, $H_{0}: \mu_{2} = \mu_{1}$.

The general idea for testing this null hypothesis is the same as it was in the one sample t-test.
In both cases, we want to calculate a t-statistic, then see where it falls along the t-distribution to decide whether or not to reject $H_{0}$.
In this case, our t-statistic ($t_{\bar{y}_{1} - \bar{y}_{2}}$) is calculated slightly differently,

$$t_{\bar{y}_{1} - \bar{y}_{2}} = \frac{\bar{y}_{1} - \bar{y}_{2}}{SE(\bar{y})}$$

The logic is the same as the one sample t-test. 
If $\mu_{2} = \mu_{1}$, then we also would expected $\bar{y}_{1} = \bar{y}_{2}$ (i.e., $\bar{y}_{1} - \bar{y}_{2} = 0$).
Differences between $\bar{y}_{1}$ and $\bar{y}_{2}$ cause the t-statistic to be either above or below 0, and we can map this deviation of $t_{\bar{y}_{1} - \bar{y}_{2}}$ from 0 to the probability density of the t-distribution after standardising by the standard error ($SE(\bar{y})$).

What is $SE(\bar{y})$ in this case?
After all, there are two different samples $y_{1}$ and $y_{2}$, so could the two samples not have *different* standard errors?
This could indeed be the case, and how we actually conduct the independent samples t-test depends on whether or not we are willing to assume that the two samples came from populations with the same variance (i.e., $\sigma_{1} = \sigma_{2}$).
If we are willing to make this assumption, then we can pool the variances ($s^{2}_{p}$) together to get a combined (more accurate) estimate of the standard error $SE(\bar{y})$ from both samples[^34]$^{,}$[^35].

If we are unwilling to assume that $y_{1}$ and $y_{2}$ have the same variance, then we need to use an alternative version of the independent samples t-test.
This alternative version is called the Welch's t-test [@Welch1938], also known as the unequal variances t-test [@Dytham2011; @Ruxton2006].
In contrast to the standard independent t-test (also called the 'Students independent t-test'), the Welch's t-test does not pool the variances of the samples together[^36].
While there are some mathematical differences between the Student's and Welch's independent samples t-tests, the general concept is the same.

This raises the question, when is it acceptable to assume that $y_{1}$ and $y_{2}$ have the same variance?
The sample variance of $s^{2}_{1} = 69.46$ and $s^{2}_{2} = 76.15$.
Is this close enough to treat them as the same?
Like a lot of choices in statistics, there is no clear right or wrong answer.
In theory, if both samples do come from a population with the same variance ($\sigma^{2}_{1} = \sigma^{2}_{2}$), then the pooled variance is better because it gives us a bit more statistical power; we can correctly reject the null hypothesis more often when it is actually false (i.e., it decreases the probability of a Type II error).
Nevertheless, the increase in statistical power is quite low, and the risk of pooling the variances when they actually are not the same increases the risk that we reject the null hypothesis when it is actually true (i.e., it increases the probability of a Type I error, which we definitely do not want!).
For this reason, some researchers advocate using the Welch's t-test by default, unless there is a very good reason to believe $y_{1}$ and $y_{2}$ are sampled from populations with the same variance [@Ruxton2006; @Delacre2017].

Here we will adopt the traditional approach of first testing the null hypothesis that $\sigma^{2}_{1} = \sigma^{2}_{2}$ using a homogeneity of variances test.
If we fail to reject this null hypothesis (i.e., $P > 0.05$), then we will use the Student's t-test, and if we reject it (i.e., $P \leq 0.05$), then we will use the Welch's t-test.
This approach is mostly used for pedagogical reasons; in practice, defaulting to the Welch's t-test is fine [@Ruxton2006; @Delacre2017].
Testing for homogeneity of variances is quite straightforward in most statistical programs, and we will save the conceptual and mathematical details of this for when we look at the F-distribution in [Chapter 23](#Chapter_23).
But the general idea is that if $\sigma^{2}_{1} = \sigma^{2}_{2}$, then the ratio of variances ($\sigma^{2}_{1}/\sigma^{2}_{2}$) has its own null distribution (like the normal distribution, or the t-distribution), and we can see the probability of getting a deviation of $\sigma^{2}_{1}/\sigma^{2}_{2}$ from 1 if $\sigma^{2}_{1} = \sigma^{2}_{2}$ is true.

In the case of the test scores from the two samples of students ($y_{1}$ and $y_{2}$), a homogeneity of variance test reveals that $s^{2}_{1} = 69.46$ and $s^{2}_{2} = 76.15$ are not significantly different (P = 0.834).
We can therefore use the pooled variance and the Student's independent samples t-test.
We can calculate $SE(\bar{y}) = 8.521033$ using the formula for $s_{p}$ (again, this is not something that ever actually needs to be done by hand), then find $t_{\bar{y}_{1} - \bar{y}_{2}}$,

$$t_{\bar{y}_{1} - \bar{y}_{2}} = \frac{\bar{y}_{1} - \bar{y}_{2}}{SE(\bar{y})} = \frac{66.58 - 61.3}{3.915144} = 1.348609.$$

As with the one-sample t-test, we can identify the position of $t_{\bar{y}_{1} - \bar{y}_{2}}$ on the t-distribution (Figure 21.2).

```{r, echo = FALSE, fig.alt = "A bell curve of the t-distribution is shown with an arrow pointing downward on the x-axis value around 1.3.", fig.cap = "A t-distribution is shown with a calculated t-statistic of 1.348609 indicated with a downard arrow."}
par(mar = c(5, 5, 1.5, 1.5));
xx       <- seq(from = -5, to = 5, by = 0.001);
xx_vals  <- 1:10001;
yy       <- dt(xx, df = 9);
plot(x = xx, y = pr_norm, type = "l", ylim = c(0, 0.48), 
     ylab = "Probability",  xlab = "t-score", lwd = 2, xlim = c(-3, 3),
     cex.lab = 1.25, cex.axis = 1.25, yaxs = "i");
polygon(c(xx[xx_vals], xx[1], xx[10001]), 
        c(pr_norm[xx_vals], 0, 0), col="grey80");
arrows(x0 = 1.348609, x1 = 1.348609, y0 = 0.1, y1 = 0.002, lwd = 3);
mbox <- function(x0, x1, y0, y1){
    xx <- seq(from=x0, to=x1, length.out = 100);
    yy <- seq(from=y0, to=y1, length.out = 100);
    xd <- c(rep(x0, 100), xx, rep(x1,100), rev(xx));
    yd <- c(yy, rep(y1,100), rev(yy), rep(y0, 100));
    return(list(x=xd, y=yd));
}
tbox <- mbox(x0 = 1.348609 - 0.15, 
             x1 = 1.348609 + 0.15, y0 = 5, y1 = 9);
polygon(x=tbox$x, y=tbox$y, lwd=3, border="black", col="white");
text(x = 1.348609, y = 0.125, cex = 2, 
     labels = expression(paste(italic(t[bar(y[1])-bar(y[2])]))));
```


The proportion of t-scores that are higher than $t_{\bar{y}_{1} - \bar{y}_{2}} = 1.348609$ is about 0.098.
In other words, given that the null hypothesis is true, the probability of getting a t-statistic this high is $P = 0.098$.
Because this p-value exceeds our critical value of $\alpha = 0.05$, we do not reject the null hypothesis.
We therefore should conclude that the mean of test scores from the current year ($\bar{y}_{1}$) is not significantly different from the mean of test scores in the previous year ($\bar{y}_{2}$).
The biology teacher in our example might therefore conclude that mean test results have not improved from the previous year.


[^34]: This is not a calculation that needs to be done by hand anymore. Statistical software such as Jamovi or R will calculate $s_{p}$ automatically from a dataset. For those interested, the formula that it uses to make this calculation is, $$s_{p} = \sqrt{\frac{\left(n_{1} - 1 \right) s^{2}_{y_{1}} + \left(n_{2} - 1 \right) s^{2}_{y_{2}}}{n_{1} + n_{2} - 2}}.$$ This looks like a lot, but really all the equation is doing is add the two variances ($s^{2}_{y_{1}}$ and $s^{2}_{y_{2}}$) together, but weighing them by their degrees of freedom ($n_{1} - 1$ and $n_{2} - 1$), so that the one with a higher sample size has more influence on the pooled standard deviation. To get $SE(\bar{y})$, we then need to multiply by the square root of $(n_{1} + n_{2})/(n_{1}n_{2})$, $$SE(\bar{y}) = s_{p}\sqrt{\frac{n_{1} + n_{2}}{n_{1}n_{2}}}.$$ It might be useful to try this once by hand, but only to convince yourself that it matches the t-statistic produced by Jamovi or R.


[^35]: Note that the degrees of freedom for the t-statistic is not straightforward when we pool variances. If the sample sizes $n_{1}$ and $n_{2}$ are the same, then $df = 2(n - 1)$. If $n_{1} \neq n_{2}$, then $df = n_{1} + n_{2} - 2$ [@Sokal1995]. The rationale here is that we lose an extra degree of freedom if we need to estimate the variance of each sample separately, which is necessary if we need to weigh each variance by its own degree of freedom (see footnote 34). Statistical software such as Jamovi and R handles all of this automatically, so we will not dwell on it here.

[^36]: The equation for calculating the Welch's t-statistic is actually a bit simpler than the Student's t-test that uses the pooled estimate [@Ruxton2006]. Instead of using $s_{p}$ (defined in footnote 34), we define our t-statistic as, $$t_{s} = \frac{\bar{y}_{1} - \bar{y}_{2}}{ \sqrt{ \frac{s^{2}_{1}}{n_{1}} + \frac{s^{2}_{2}}{n_{2}}} }.$$ The degrees of freedom, however, is quite a bit messier than it is for the independent samples Student's t-test, $$v = \frac{\left(\frac{1}{n_{1}} + \frac{(s^{2}_{2} / s^{2}_{1})}{n_{2}} \right)^{2}}{\frac{1}{n^{2}_{1}\left(n_{1} - 1 \right)} + \frac{(s^{2}_{2} / s^{2}_{1})^{2}}{n^{2}_{2}\left(n_{2} - 1 \right)}}.$$ Of course, Jamovi and R will make these calculations for us, so it is not necessary to do it by hand.


## Paired sample t-test

There is one more type of t-test to consider.
The paired sample t-test is applied when the data points in one sample can be naturally paired with those in another sample.
In this case, data points are not independent between samples are not independent.
For example, we can consider the student test scores ($y_{1}$) yet again.

```
49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1
```

Suppose that the teacher gave these same students (S1-S10) a second test and wanted to see if the mean student score changed from one test to the next (i.e., a two-sided hypothesis).

```{r, echo = FALSE, eval = TRUE}
t1 <- c(49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1);
ch <- c(-2.7, -0.2, 0.1, -7.2, -2.8, -1.0, 3.0, -2.1, 3.4, 0.7);
t2 <- t1 + ch;
tt <- rbind(t1, t2, ch);
rownames(tt) <- c("Test 1", "Test 2", "Change");
colnames(tt) <- paste("S", 1:10, sep = "");
knitr::kable(tt);
```

Table: Test scores from 10 students (S1-S10) for 2 different tests in a hypothetical biology education example.

In this case, what we are really interested in is the *change* in scores from Test 1 to Test 2.
We want to test the null hypothesis that this change is zero.
This is actually the same test as the one-sample t-test.
We are just substituting the mean difference in values (i.e., 'Change' in the table above) for $\bar{y}$ and setting $\mu_{0} = 0$.
We can calculate $\bar{y} = -0.88$ and $SE(\bar{y})=0.9760237$, then set up the t-test as before,

$$t_{\bar{y}} = \frac{-0.88 - 0}{0.9760237} = -0.9016175.$$

Again, we can find the location of our t-statistic $t_{\bar{y}} = -0.9016175$ on the t-distribution (Figure 21.3).


```{r, echo = FALSE, fig.alt = "A bell curve of the t-distribution is shown with an arrow pointing downward on the x-axis value around -0.9.", fig.cap = "A t-distribution is shown with a calculated t-statistic of -0.9016175 indicated with a downard arrow."}
par(mar = c(5, 5, 1.5, 1.5));
xx       <- seq(from = -5, to = 5, by = 0.001);
xx_vals  <- 1:10001;
yy       <- dt(xx, df = 9);
plot(x = xx, y = pr_norm, type = "l", ylim = c(0, 0.48), 
     ylab = "Probability",  xlab = "t-score", lwd = 2, xlim = c(-3, 3),
     cex.lab = 1.25, cex.axis = 1.25, yaxs = "i");
polygon(c(xx[xx_vals], xx[1], xx[10001]), 
        c(pr_norm[xx_vals], 0, 0), col="grey80");
arrows(x0 = -0.9016175, x1 = -0.9016175, y0 = 0.1, y1 = 0.002, lwd = 3);
mbox <- function(x0, x1, y0, y1){
    xx <- seq(from=x0, to=x1, length.out = 100);
    yy <- seq(from=y0, to=y1, length.out = 100);
    xd <- c(rep(x0, 100), xx, rep(x1,100), rev(xx));
    yd <- c(yy, rep(y1,100), rev(yy), rep(y0, 100));
    return(list(x=xd, y=yd));
}
tbox <- mbox(x0 = -0.9016175 - 0.15, 
             x1 = -0.9016175 + 0.15, y0 = 5, y1 = 9);
polygon(x=tbox$x, y=tbox$y, lwd=3, border="black", col="white");
text(x = -0.9016175, y = 0.125, cex = 2, 
     labels = expression(paste(italic(t[bar(y)]))));
```


Since this is a two-sided hypothesis, we want to know the probability of getting a t-statistic as extreme as -0.9016175 (i.e., either $\pm 0.9016175$) given that the null distribution is true.
In the above t-distribution, 95\% of the probability density lies between $t = -2.26$ and $t = 2.26$.
Consequently, our calculated $t_{\bar{y}} = -0.9016175$ is not sufficiently extreme to reject the null hypothesis.
The p-value associated with $t_{\bar{y}} = -0.9016175$ is $P = 0.391$.
We therefore fail to reject $H_{0}$ and conclude that there is no significant difference change in student test scores from Test 1 to Test 2.

## Assumptions of t-tests

We make some potentially important assumptions when using t-tests.
A consequence of violating these assumptions is a potentially misleading Type I error rate.
That is, if our data to not fit the assumptions of our statistical test, then we might not actually be rejecting our null hypothesis at the $\alpha = 0.05$ level.
We might unknowingly be rejecting $H_{0}$ at a much higher $\alpha$ value, and therefore concluding that we have evidence supporting the alternative hypothesis $H_{A}$ when really do not.
It is therefore important to recognise the assumptions that we are making when using any statistical test (including t-tests).
If our assumptions are violated, we might need to use a different test, or perhaps apply some kind of transformation on the data.
Assumptions that we make when conducting a t-test are as follows:

- Data are continuous (i.e., not count or categorical data)
- Sample observations are a random sample from the population
- Sample means are normally distributed around the true mean

Note that if we are running a Student's independent samples t-test that pools sample variances (rather than a Welch's t-test), then we are also assuming that sample variances are the same (i.e., a homogeneity of variance).
The last bullet point concerning normally distributed sample means is frequently misunderstood to mean that the *sample* data themselves need to be normally distributed.
This is not the case [@Johnson1995; @Lumley2002].
Instead, what we are really concerned with is the distribution of sample means ($\bar{y}$) around the true mean ($\mu$).
And given a sufficiently large sample size, a normal distribution is assured due to the central limit theorem (see [Chapter 15](#Chapter_15)).

Moreover, while a normally distributed variable is not *necessary* for satisfying the assumptions of a t-test (or many other tests we will introduce in this book), it is *sufficient*.
In other words, if the variable being measured is normally distributed, then the sample means will also be normally distributed around the true mean (even at low sample size).
So when is a sample size large enough, or close enough to being normally distributed, for the assumption of normality to be satisfied?
There really is not a definitive answer to this question, and the truth is that most statisticians will prefer to use a histogram (or some other visualisation approach) and their best judgement to decide if the assumption of normality is likely to be violated.

In this book, we will take the traditional approach of running a statistical test called the Shapiro-Wilk test to test the null hypothesis that data are normally distributed.
If we reject the null hypothesis (when $P < 0.05$), then we will conclude that the assumption of normality is violated and the t-test is not appropriate.
The details of how the Shaprio-Wilk test work are not important for now, but the test can be easily run using Jamovi or R.
If we reject the null hypothesis that the data are normally distributed, then we can use one of two methods to run our statistical test.

1. Transform the data in some way (e.g., take the log of all values) to improve normality.
2. Use a non-parameteric alternative test.

The word 'non-parameteric' in this context just means that there are no assumptions (or very few) about the shape of the distribution [@Dytham2011].
We will consider the non-parametric equivalents of the one-sample t-test (the Wilcoxon test) and independent sample t-test (Mann Whitney test) in the next session.
But first, we can show how transformations can be used to improve the fit of the data to model assumptions.

Often data will have a skewed distribution; this just means that the distribution will be asymmetrical.
For example, in Figure 21.4A below, we have a dataset (sample size $N = 200$) with a large positive skew (i.e., it is right skewed).
Most values are in the same general area, but with some values being especially high.

```{r, echo = FALSE, fig.alt = "A two paneled figure in which a histogram with a skewed distribution is shown to the left and a histogram with a normal distribution is shown to the right.", fig.cap = "A set of values with a high positive skew (A), which, when log-transformed (i.e., when we take the natural log of all values), have a normal distribution."}
skewed_data <- exp(rnorm(n = 200));
log_tranfrm <- log(skewed_data);
par(mfrow = c(1, 2), mar = c(5, 5, 1, 1));
hist(x = skewed_data, main = "", xlab = "X", breaks = 10, xlim = c(0, 20),
     ylim = c(0, 160));
text(x = 15, y = 150, cex = 2, labels = "A");
hist(x = log_tranfrm, main = "", xlab = "LN(X)", breaks = 10, xlim = c(-4, 4),
     ylim = c(0, 50));
text(x = 2.7, y = 48, cex = 2, labels = "B");
```

Using a t-test on the variable X shown in Figure 21.4A is probably not the good idea.
But taking the natural log of all the values of X makes the dataset more normally distributed, thereby more convincingly satisfying the normality assumption required by the t-test.
This might seem a bit suspicious at first.
Is it really okay to just take the logarithm of all the data instead of the actual values that were measured?
Actually, there is no real scientific or statistical reason that we need to use the original scale [@Sokal1995].
Using the log or the square-root of a set of numbers is perfectly fine if it helps better satisfy the assumptions of a statistical test.


## Non-parametric alternatives

If we find that the assumption of normality is not satisfied, and a transformation of the data cannot help, then we can consider using non-parametric alternatives to a t-test.
These alternatives include the Wilcoxon test and the Mann-Whitney U test.

### Wilcoxon test

The Wilcoxon test (also called the Wilcoxon signed-rank test) is the non-parametric alternative to a one sample t-test (or a paired t-test).
Instead of using the actual data, the Wilcoxon test ranks all of the values in the dataset, then sums up their signs (either positive or negative).
The general idea is that we can compare the sum of the *ranks* of the actual data with what would be predicted by the null hypothesis.
It tests the null hypothesis that the *median* ($M$) is significantly different from some given value[^37].
An example will make it easier to see how it works.
We can use the same hypothetical dataset on student test scores.

```
49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1
```

The first step is to subtract the null hypothesis value ($M = 60$, if we again set $H_{0}$ to be that student test scores equal 60) from each value ($49.3 - 60 = -10.7$, $62.9 - 60 = 2.9$, etc.).

```
-10.7, 2.9, 13.7, 5.5, 9.6, 10.7, 1.5, 13.4, 1.1, 18.1
```

We need to note the sign of each value as negative ($-$) or positive ($+$).

```
-, +, +, +, +, +, +, +, +, +
```


Next, we need to compute the absolute values of the numbers (i.e., $|-10.7| = 10.7$, $|2.9| = 2.9$, $|13.7| = 13.7$, etc.).

```
10.7, 2.9, 13.7, 5.5, 9.6, 10.7, 1.5, 13.4, 1.1, 18.1
```

We then rank these values from lowest to highest and record the sign of each value.

```
6.5, 3.0, 9.0, 4.0, 5.0, 6.5, 2.0, 8.0, 1.0, 10.0
```

Note that both the first and sixth position had the same value (10.7), so instead of ranking them as 6 and 7, we split the difference and rank both as 6.5.
Now, we can calculate the sum of the negative ranks ($W^{-}$), and the positive ranks $W^{+}$.
In this case, the negative ranks are easy; there is only one value (the first one), so the sum is just 6.5,

$$W^{-} = 6.5$$

The positive values are 2-10, so we need to sum these ranks now,

The positive ranks are in positions , and the rank values in these positions are 8, 2, 4, 7, and 9.
The sum of our positive ranks is therefore,

$$W^{+} = 3.0 + 9.0 + 4.0 + 5.0 + 6.5 + 2.0 + 8.0 + 1.0 + 10.0 = 48.5$$

Note that the sum of $W^{-}$ and $W^{+}$ (i.e., 6.5 + 48.5 = 55 in the example here) must always equal for a given sample size $N$ (in this case, $N = 10$),

$$W = \frac{N \left(N + 1 \right)}{2}.$$


What the Wilcoxon test is doing is calculating the probability of getting a value of $W^{+}$ as or more extreme than would be the case if the null hypothesis is true.
Note that if, e.g., if there are an equal number of values above and below the median, then both $W^{-}$ and $W^{+}$ will be relatively low and about the same value.
This is because the ranks of the values below 0 (which we times by -1) and above 0 (which we times by 1) will be about the same.
But if there are a lot more values above the median than expected (as with the example above), then $W^{+}$ will be relatively high.
And if there are a lot more values below the median than expected, then $W^{+}$ will be relatively low.

To find the probability of $W^{+}$ being as low or high as it is given that the null hypothesis is true (i.e., a p-value), we need to compare the test statistic $W^{+}$ to its distribution under the null hypothesis (note that we can also conduct a one-tailed hypothesis, in which case we are testing if $W^{+}$ is either higher or lower than expected given $H_{0}$).
The old way of doing this is to compare the calculated $W^{+}$ threshold values from a  [
Wilcoxon Signed-Ranks Table](#wilcoxon-signed-rank-critical-values).
The critical value table is no longer necessary, and statistical software such as Jamovi and R will calculate a p-value for us.
For the example above, the p-value associated with $W^{+} = 48.6$ and $N = 10$ is $P = 0.037$.
Since this p-value is less than our threshold of $\alpha = 0.05$, we can reject the null hypothesis and conclude that the median of our dataset is significantly different from 60.

Note that we can also use a Wilcoxon signed rank test as a non-parametric equivalent to a paired t-test. 
In this case, instead of subtracting out the null hypothesis of our median value (e.g., $H_{0}: M = 60$ in the example above), we just need to subtract the paired values.
Consider again the example of the 2 different tests introduced for the [paired sample t-test](#paired-sample-t-test) above.

```{r, echo = FALSE, eval = TRUE}
t1 <- c(49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1);
ch <- c(-2.7, -0.2, 0.1, -7.2, -2.8, -1.0, 3.0, -2.1, 3.4, 0.7);
t2 <- t1 + ch;
tt <- rbind(t1, t2, ch);
rownames(tt) <- c("Test 1", "Test 2", "Change");
colnames(tt) <- paste("S", 1:10, sep = "");
knitr::kable(tt);
```

Table: Test scores from 10 students (S1-S10) for 2 different tests in a hypothetical biology education example.

If the 'Change' values were not normally distributed, then we could apply a Wilcoxon test to test the null hypothesis that the median value of $Test\:2 - Test\:1 = 0$ (note that a Shapiro-Wilk normality does not reject the null hypothesis that the difference between test scores is normally distributed, so the paired t-test would be preferred in this case).
To do this, we would first note the sign of each value as negative or positive. 

```
-, -, +, -, -, -, +, -, +, +
```

Next, we would rank the absolute values of the changes.

```
6, 2, 1, 10, 7, 4, 8, 5, 9, 3
```

If we then sum the ranks, we get $W^{-} = 6 + 2 + 4 + 5 + 6 + 8 = 31$ and $W^{+} = 1 + 8 + 9 + 3 = 21$.
The p-value associated with $W^{+} = 21$ and $N = 10$ is $P = 0.55$, so we do not reject the null hypothesis that Test 1 and Test 2 have the same median.


[^37]: Actually, the Wilcoxon signed-rank test technically tests the null hypothesis that two distributions are identical, not just that the medians are identical [@Johnson1995; @Lumley2002]. Note that if one distribution has a higher variance than another, or is differently skewed, it will also affect the ranks. In other words, if we want to compare medians, then we need to assume that the distributions have the same shape [@Lumley2002]. Because of this, and because the central limit theorem ensures that means will be normally distributed given a sufficiently high sample size (in which case, t-test assumptions are more likely to be satisfied), some researchers suggest that nonparametric statistics such as the Wilcoxon signed rank test should be used with caution [@Johnson1995].

### Mann-Whitney U test

A non-parametric alternative of the independent samples t-test is the Mann-Whitney U test.
That is, a Mann-Whitney test can be used if we want to know whether the median of two independent groups is significantly different.
Like the Wilcoxon test, the Mann-Whitney U test uses the ranks of values, rather than the values themselves.
In the Mann-Whitney U test, the general idea is rank all of the data across both groups, then see if the sum of the ranks is significantly different [@Sokal1995].
To demonstrate this, we can again consider the same hypothetical dataset used when demonstrating the [independent samples t-test](#independent-samples-t-test) above.
Test scores from the current year ($y_{1}$) are below.

```
49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1
```

We want to know if the median of the above scores is significantly different from the median scores in the previous year ($y_{2}$) shown below.

```
57.4, 52.4, 70.5, 71.6, 46.1, 60.4, 70.0, 64.5, 58.8
```

There are 19 values in total, 10 values for $y_{1}$ and 9 values for $y_{2}$.
We therefore rank *all* of the above values from 1 to 19.
For $y_{1}$, the ranks are below.

```
2, 9, 18, 11, 12, 15, 8, 17, 7, 19
```

For $y_{2}$, the ranks are below.

```
4, 3, 14, 16, 1, 6, 13, 10, 5
```

This might be easier to see if we present it as a table showing the test Year ($y_{1}$ versus $y_{2}$), test Score, and test Rank.

```{r, echo = FALSE, eval = TRUE}
Score   <- c(49.3, 62.9, 73.7, 65.5, 69.6, 70.7, 61.5, 73.4, 61.1, 78.1,
             57.4, 52.4, 70.5, 71.6, 46.1, 60.4, 70.0, 64.5, 58.8);
Year    <- c(rep(1, 10), rep(2, 9));
Rank    <- rank(Score);
MWtable <- cbind(Year, Score, Rank);
knitr::kable(MWtable);
```

Table: Test scores from different students across 2 years, and the overall rank of each test score, in a hypothetical biology education example.

What we need to now is sum the ranks for $y_{1}$ and $y_{2}$.
If we add up the $y_{1}$ ranks, then we get a value of $R_{1}=$ `r sum(Rank[1:10])`.
If we add up the $y_{2}$ ranks, then we get a value of $R_{2}=$ `r sum(Rank[11:19])`.
We can then calculate a value $U_{1}$ from $R_{1}$ and the sample size of $y_{1}$ ($N_{1}$),

$$U_{1} = R_{1} - \frac{N_{1}\left(N_{1} + 1 \right)}{2}.$$

In the case of our example, $R_{1}=$ `r sum(Rank[1:10])` and $N_{1} = 10$, 
We therefore calculate $U_{1}$,

$$U_{1} = `r sum(Rank[1:10])` - \frac{10\left(10 + 1 \right)}{2} = 63.$$

We then calculate $U_{2}$ using the same general formula,

$$U_{2} = R_{2} - \frac{N_{2}\left(N_{2} + 1 \right)}{2}.$$

From the above example of test scores,

$$U_{2} = `r sum(Rank[11:19])` - \frac{9\left(9 + 1 \right)}{2} = 27.$$

Whichever of $U_{1}$ or $U_{2}$ is lower[^38] is set to $U$, so for our example, $U = 27$.
Note that if $y_{1}$ and $y_{2}$ have similar medians, then $U$ will be relatively low.
But if $y_{1}$ and $y_{2}$ have much different medians, then $U$ will be relatively high.
One way to think about this is that if $y_{1}$ and $y_{2}$ are very different, then one of the two samples should have very low ranks, and the other should have very high ranks [@Sokal1995].
But if $y_{1}$ and $y_{2}$ are very similar, then their summed ranks should be nearly the same.
Hence, if the deviation of $U$ is greater than what is predicted given the null hypothesis in which the distributions (and therefore the medians) of $y_{1}$ and $y_{2}$ are identical, the we can reject $H_{0}$.

As with the [Wilcoxon test](#wilcoxon-test), we could compare our $U$ test statistic to a critical value from a [table](#mann-whitney-u-critical-values), but statistical software such as Jamovi or R will also just give us the test statistic $U$ and associated p-value.
In our example above, $U = 27$, $N_{1} = 10$, and $N_{2} = 9$ has a p-value of $P = 0.156$, so we do not reject the null hypothesis.
We therefore conclude that there is no evidence that there is a difference in the median test scores of the two years.

[^38]: Note that you could also take the higher of the two values [@Sokal1995], which is what R uses (Jamovi uses the lower of the two). The null distribution from which the p-value would be calculate would just be different in this case. 

## Summary

The main focus of this chapter was to provide a conceptual explanation of different statistical tests.
In practice, running these tests is relatively straightforward in statistical software such as Jamovi or R (this is good, as long as the tests are understood and interpreted correctly).
In general, the first step in approaching these tests is to determine if the data call for a one sample test, an independent samples test, or a paired samples test.
In a one sample test, the objective is to test the null hypothesis that the mean (or median) equals a specific value.
In an independent samples test, there are two different groups, and the objective is to test the null hypothesis that the groups have the same mean (or median).
In a paired samples test, there are two groups, but individual values are naturally paired between each group, and the objective is to test the null hypothesis that the difference between paired values is zero[^39].
If assumptions of the t-test are violated, then it might be necessary to use a data transformation or a non-parametric test such as the Wilcoxon test (in place of a one sample or paired sample t-test) or a Mann-Whitney U test (in place of an independent samples t-test).


[^39]: Note, you could also test the null hypothesis that the difference between paired values is some value other than zero, but this is quite rare in practice.

# _Practical_. Hypothesis testing and t-tests {#Chapter_22}


## Exercise on a simple one sample t-test

## Exercise on an independent sample t-test

## Exercise involving multiple comparisons


## Exercise with non-parametric


## Another exercise with non-parametric















